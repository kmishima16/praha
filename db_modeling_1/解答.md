# 寿司注文 データベース設計

## テーブル設計

以下の図のテーブルを作成しました。

![ER図](https://github.com/kmishima16/praha/blob/image2/db_modeling_1/image/%E6%A6%82%E7%95%A5ER%E5%9B%B3.png)

## ユースケース

#### マスタ更新時のユースケース

| ユースケース  | 更新内容       | SQL                                  |
| ------- | ---------- | --------------------------------------- |
| 商品の価格更新 | 中とろを460円→400円に変更する | [DML](https://github.com/kmishima16/praha/blob/feature/db_modeling_1/docker-mysql/script/03DML_usecase1.sql)

#### 注文時のユースケース

| ユースケース          | 注文内容                                              | SQL                  |
| --------------- | ------------------------------------------------- | -------------------------- |
| 普通の注文           | まぐろ２皿、いか２皿、ほたて１皿、巻きずし３皿                           | [DML](https://github.com/kmishima16/praha/blob/feature/db_modeling_1/docker-mysql/script/04DML_usecase2.sql)        |
| オプション有          | ケース1に加えて、まぐろ１皿をわさび抜き、いか２皿をシャリ小、ほたてをわさび抜きかつシャリ小にする | 作成中 |
| オプション有、かつクーポンあり | ケース２の注文に、10%割引クーポンを適用する                           | 作成中  |

#### 各ユースケースのクエリ結果

（作成中）DMLの実行結果を以下にまとめる予定です  

```sql
-- VIEWを参照して注文合計額を確認する
mysql> SELECT * FROM `hoge-db`.order_amount;
+----------+-------------+--------------+
| order_id | customer_id | SUM(p.price) |
+----------+-------------+--------------+
|        1 |           1 |        10460 |
+----------+-------------+--------------+
1 row in set (0.00 sec)
```

- オーダーに対してのオプション付き商品

```sql
-- 注文のうち、オプション付きの商品
select 
  od.order_id as "注文ID",
  od.product_id as "商品ID",
  prd.name as "商品名",
  op.id as "オプションid",
  op.name as "オプション名"
from `order_details` as od
inner join `options` as op on od.option_id = op.id
inner join `products` as prd on od.product_id = prd.id;

+----+----+--------------+----+-----------------+
| ID | ID |              | id |                 |
+----+----+--------------+----+-----------------+
|  1 | 15 | 玉子         |  1 | わさび抜き      |
|  1 | 22 | ゆでげそ     |  2 | シャリ半分      |
+----+----+--------------+----+-----------------+
2 rows in set (0.00 sec)
```
