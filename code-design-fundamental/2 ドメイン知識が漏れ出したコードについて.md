---
id: 20250120T12250290
aliases: 
tags:
  - review
created: 2025-01-20T12:25:02
updated: 2025-01-20T12:25:02
sr-due: 2025-01-23
sr-interval: 3
sr-ease: 250
---

# 課題2

例えば[このサンプルコード](https://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgAoFcoIBZwM4oDeAUMsugVAJIAmAXMnmFKAOanIAOUA9jegjC0GTFiHZlmcEHkRhgPEAxJkyeAUgg0tDZuggcyCHgFtOAGwiQaAQTAMAInEgcAvsXfFQkWIhSo4AE8TCHAAJQhjKBoIzh5kFWRWKwwsXAI8ACFAhgAKCmhhRmY2AEpkAF4APjRMHHwIAG0AXQ9iYgRzfDxatIaAZWgAN2AkBI5OdAAjc1HkYxk9QR4oXO5gIecUTiCQ8MiVmIg4hgDg0LAIqKO48sJPMkmZucm+gnzKItE2ABouXn4gi+JXEd0M80UTGQcHM5lS9QylWQYGwwDwADodud9tdYjx0ckwPD0hAsoEPoUaKVwQsoTsmMSGkiYXC6iSMTBQDRcmtytUuJiAQIhDRKhUKv8+MLaMgAGSygVSGRyBQgdHqBCabRU8HAGDINb4Ilshpg1SqFG8ADuyBAEBtAFEoLxVgByQDKDIA7BkAYqqAQZVAPYMgCkGQBODIALBkAUQyAVQZAH4MgAA5X2ABTTAFnagHMGQCaDIBAf9d1PND1UAHp88hAD8xgFNFQDSRoAs30AsgyAawZAEwJgACGNweIAhttps://www.typescriptlang.org/play?#code/JYOwLgpgTgZghgYwgAgAoFcoIBZwM4oDeAUMsugVAJIAmAXMnmFKAOanIAOUA9jegjANUvfoI7M4IPIjDAeIBiTJk8ApBBqaGzdBA5kEPALacANhEg0AgkOQAROJA4BfYm+KhIsRChF8BMGRlLlFA2gYmFhB2MhA4YwhI5jYOAjB-MTA8YTDBAG0AXXdiT3BoeCQ0OABPRPAAJQgjKBomzh5gjlZLDCxcAjwAIRqGAAoKaAjGFJiASmQAXgA+NEwcfAgikuIEM3w8Nf7NgGVoADdgKpDOdAAjMyvkI2ldQR4oMe5gc6cUTlq9TATRabQgHWEgIgjWaHzBHQWhA8ZFuDyet2OBAmlGmUTYABpQgFBLjZqxEQZngomMg4GYzH0NoMlsgwNhgHgAHQAurQ4Gw1rtHicnoZdYDCDDGrYqY0OalFS0+mMiVcmAfACiiGwYy+4s2CxWXUVZGAMGQesxEG5eTAnPSmUCXOMcE4us4htWnBtxLAtDmnNAe3QWjwX1t-opJpUbN4AHdkCAIAmNVBeJ8AOSAboZAMMMgAmGQBiqoBBlUASQyAH5jAKaKgAg7QD+DIA7BkAnaaAewZAIAMgGUGOvFkuAFQZK4ARBkA+gyAAwZAIoMgD8GQDaDIBkhkAgP8Z+XRtyKlzyykAejXyErgGkjQBZvoBZBkA1gyAJgTAAEMrncQA)では「特定の商品は1人につき年間1つまでしか買えない」といった仕様を実現しようとしています。このコードにはどのような問題点が潜んでいるでしょうか？もしあなたが書き換えるとしたら、どのようにこのコードを改修しますか？

<aside>
💡 「アプリケーション側ではなくSQLで絞り込む」という改修を思い当たるかもしれません。しかしその場合「過去1年以内に特定の商品を購入した履歴を抽出する」という、特定のドメインロジックに依存したSQLが生まれてしまいます。今後「過去3ヶ月以内に商品を購入した場合は購入不可とする」「プレミアム会員の場合は1年に何個でも購入可能とする」といったロジックが生まれると、それらのロジックがSQLに含まれて、SQLがどんどん複雑に肥大化していきます。

一方、アプリケーション側だけで絞り込みを実現しようとすると（今回のように、まず特定ユーザーの過去の購入履歴を全て取得してから絞り込むといったアプローチだと）性能面で問題が起きるかもしれません。

どちらの方法もメリットデメリットがありそうですね・・・！（実際そういう問題なので答えはケースバイケースなのですが、どんな時にどちらの選択肢を選ぶか考えてみると面白いかもしれません）。

明確な答えが出る問題ではないので「こういう時はA」「こういう時はB」と、どのような条件化でそれぞれの選択が適切になるのか話し合ってみると良いでしょう！

</aside>

